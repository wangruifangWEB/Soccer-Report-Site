<!DOCTYPE html>
<html>
<head>
    <script src="static/js/jquery.min.js"></script>

    <script src="static/js/underscore-min.js"></script>

    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
    <script src="static/js/bootstrap.min.js"></script>

    <script src="static/js/d3.min.js"></script>
    <script src="static/js/vega.min.js" charset="utf-8"></script>
    <script src="static/js/vega-lite.min.js" charset="utf-8"></script>
    <script src="static/js/vega-embed.min.js" charset="utf-8"></script>

    <script type="text/javascript">
        function encodeURI(part) {
            return encodeURIComponent(part).replace(/%20/g, "+");
        }

        function visualize(selector, spec) {
            vg.embed(selector, {
                mode: "vega-lite",
                spec: spec,
                renderer: "svg"
            });
        }

        $(document).ready(function() {
            $.getJSON("config.json", function(config) {
                var host = config.host;
                var tasks = config.tasks;

                $(".vis").map(function() {
                    var id = $(this).attr('id');

                    $.getJSON(`http://${host}/retrieve/${id}`, function(response) {
                        var list = response.data;
                        var options = "";
                        if (list.length > 0) {
                            for (var i = 0; i < list.length; i++) {
                                options += `<option value="${list[i]}">${list[i]}</option>`;
                            }

                            $(`#${id} > select`).html(options);
                            $(`#${id} > select > option:first-of-type`).prop("selected", true);
                        }
                    });

                    $.getJSON(`vis/${id}.json`, function(response) {
                        var vlSpec = response;

                        $(`#${id} > select`).change(function() {
                            var argName = tasks[id].arg;
                            $.getJSON(`http://${host}/run/${id}?${argName}=${encodeURI($(this).val())}`, function(response) {
                                vlSpec.data.values = response.data;
                                visualize(`#${id} > div`, vlSpec);
                            });
                        });

                        setTimeout(function() {
                            $(`#${id} > select`).trigger("change");
                        }, 200);
                    });
                });
            });
        });
    </script>

    <style>
        .vega-actions a {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div style="max-width:1000px">
        <div class="vis" id="opposition">
            <select></select>
            <div></div>
        </div>

        <div class="vis" id="player_analysis_graph">
            <select></select>
            <div></div>
        </div>
    </div>
</body>
</html>
